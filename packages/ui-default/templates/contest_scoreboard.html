{% import "components/paginator.html" as paginator with context %}
{% extends "layout/basic.html" %}
{{ set(UiContext, 'tdoc', tdoc) }}
{% set type = 'homework' if tdoc.rule == 'homework' else 'contest' %}

{% macro renderRecord(cell, canView) %}
  <a href="{{ url('record_detail', rid=cell.raw) if canView else '' }}"{% if cell.hover %} data-tooltip="{{ cell.hover }}"{% endif %}>
    {%- set _color = utils.status.getScoreColor(cell.score|default(cell.value)) -%}
    <span style="font-weight:bold;color:{{ _color }}">{{ cell.value|string|nl2br|safe }}</span>
  </a>
{% endmacro %}

{% block content %}
<div class="row"><div class="medium-12 columns scoreboard--{{ tdoc.rule }}">
  <div class="section visible">
    <div class="section__header">
      {%- for ext in ['HTML','CSV','Ghost'] -%}
        <a class="button" target="_blank" href="{{ url(type + '_scoreboard_download', tid=tdoc.docId, ext=ext.toLowerCase()) }}">
          <span class="icon icon-download"></span> {{ _('Export as {0}').format(ext) }}
        </a>
      {%- endfor -%}
      {% if model.contest.isDone(tdoc) and tdoc.lockAt and handler.user.own(tdoc) and not tdoc.unlocked %}
        <form method="POST">
          <input type="hidden" name="operation" value="unlock">
          <button type="submit" class="button">
            <span class="icon icon-feeling-lucky"></span> {{ _('Unlock scoreboard') }}
          </button>
        </form>
      {% endif %}
      <div class="section__tools">
        <select class="select filter" name="list">
          <option value="all">{{ _('All Users') }}</option>
          <option value="star">{{ _('Starred Users') }}</option>
          <option value="rank">{{ _('Ranked Users') }}</option>
        </select>
      </div>
    </div>
    {% include "partials/scoreboard.html" %}
  </div>
</div></div>
{% endblock %}
