version: '3.7'

services:
    
  oj-db:
    image: mongo
    container_name: oj-db
    restart: always
    volumes:
      - ./data/db:/data/db
    environment:
      - TZ=Asia/Shanghai

  oj-judge:
    image: executorserver
    privileged: true
    container_name: oj-judge
    restart: always
    volumes:
      - /root/.cache/hydro/judge:/root/.cache/hydro/judge
      - /tmp/hydro/judge.tmp:/tmp/hydro/judge.tmp
      - ./packages/hydrojudge/vendor/testlib:/root/Hydro/packages/hydrojudge/vendor/testlib
    environment:
      - TZ=Asia/Shanghai

  oj-main:
    build: ./
    container_name: oj-main
    restart: always
    privileged: true
    depends_on:
      - oj-db
      - oj-judge
    volumes:
      - /tmp/hydro/judge.tmp:/tmp/hydro/judge.tmp
      - ./data/oj:/root/.hydro
      - /root/.cache/hydro/judge:/root/.cache/hydro/judge
    ports:
      - "0.0.0.0:8888:8888"
    environment:
      - TZ=Asia/Shanghai